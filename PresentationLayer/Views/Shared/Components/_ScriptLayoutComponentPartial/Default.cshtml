
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
<script>
    var baseUrl = document.querySelector('base').getAttribute('href');
    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (!settings.url.startsWith(baseUrl)) {
                settings.url = baseUrl + settings.url;
            }
        }
    });
    function showAlertModal(message) {
        $('#alertMessage').text(message);
        var alertModal = new bootstrap.Modal(document.getElementById('alertModal'), {});
        alertModal.show();
    }
    $(document).ready(function () {
        $(document).ajaxStart(function () {
            $('#loader-overlay').removeClass('d-none'); // Muestra el overlay y el loader
        });

        $(document).ajaxStop(function () {
            $('#loader-overlay').addClass('d-none'); // Oculta el overlay y el loader
        });
    });
    window.validarYProcesarFormulario = function (errorsObservable, callback) {
        console.log('Errores observables:', errorsObservable()); // Muestra todos los errores

        if (errorsObservable().length === 0) {
            callback(); // Ejecuta la función de guardado si no hay errores
        } else {
            // Muestra los mensajes de error
            errorsObservable.showAllMessages();

            function isElementVisible(el) {
                return el && el.offsetParent !== null &&
                    getComputedStyle(el).visibility !== 'hidden' &&
                    getComputedStyle(el).opacity !== '0';
            }

            // Encuentra y muestra en consola los elementos visibles con error
            var errorElements = document.querySelectorAll('.text-danger:not([style*="display: none"]), .has-error input, .has-error select, .has-error textarea');
            console.log('Elementos con error visibles:', errorElements);

            var firstErrorElement = Array.from(errorElements).find(isElementVisible);
            console.log('Primer elemento con error encontrado:', firstErrorElement);
            console.log('Elementos con error visibles:', errorElements);
            if (firstErrorElement) {
                firstErrorElement.focus();
                firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
            
                console.log('No hay un elemento visible con error.');
            }
        }
    };
</script>
